# Module 12 - Evading IDS, Firewalls and Honeypots

## concepts
- IDS (Intrusion detection system)
    - best when placed near the firewall (one in front of the firewall, one behind it)
    - does not stop anything
    - signature detection
    - anomaly detection
    - protocol anomaly detection
- types of IDS
    - network-based
    - host-based - no need of extra hardware
- types of alarm
    - true positive (attack -> alert)
    - false positive (no attack -> alert)
    - false negative (attack -> no alert)
    - true negative (no attack -> no alert)
- IPS (type of IDS with capability of preventing intrusions)
- Firewall (hardware vs software)
    - bastion host
    - screened subnet
    - multi-homed subnet
- firewall technologies
    - packet filtering firewall - works on layer 3 (network)
    - circuit-level gateway firewall - works on layer 4 (transport)
    - stateful multilayer inspection firewall - works on layer 3, 4 and 5
    - stateless firewall - restricts packets based on source and destination addresses or other static values
    - application-level firewall - works on layer 5, 6 and 7
        - it works like a proxy server
    - application proxy (can be merged with application-level firewall)
    - NAT (Network Address Translation)
    - VPN (Virtual Private Network)
- Honeypot
    - it's not real, it's a trap, it's a decoy
    - emulates system resources
    - it's meant to attract an attacker
    - types
        - low-interaction - simulate only the services frequently requested by attackers
        - high-interaction - imitate the activities of the production systems that host a variety of services
        - pure - are full-fledged production systems
    - deployment classification
        - production
        - research
    - deception classification
        - malware
        - database
        - spam
        - email
        - spider
        - honeynets
- Data loss prevention (DLP) - detects potential data breaches/data ex-filtration transmissions and prevents them by monitoring, detecting, and blocking sensitive data
- snort
    - rules
        - `alert tcp any any -> 192.168.1.0/24 111(content:"|00 01 86 a5|"; msg: "mountd access";)`
            - rule action
            - protocol
            - source IP
            - source port
            - direction
            - destination IP
            - destination port
            - alert message
    - packet logger mode
        - `snort -dev -l ./log`
- IDS evasion techniques
    - Insertion Attack
    - Evasion
    - DoS Attack
    - False Positive Generation
    - Session Splicing
    - Unicode Evasion
    - Fragmentation Attack
    - Time-To-Live Attacks
    - ASCII Shellcode
    - Desynchronization
    - obfuscating
    - overlapping fragments
    - invalid RST packets
    - urgency flag
    - polymorphic shellcode - encrypts the shellcode by XORing values over the shellcode, using loader code to decrypt the shellcode, and then executing the decrypted shellcode.
    - Application-layer attack
    - Encryption
    - Flooding
- firewall evasion techinques
    - Port Scanning
    - Firewalking (uses TTL to maps network analyzing IP packet responses)
    - Banner Grabbing
    - IP Address Spoofing
    - Source Routing
    - Tiny Fragments
    - Using an IP Address in Place of a URL
    - Using Anonymous Website Surfing Sites
    - Using a Proxy Server
    - ICMP Tunneling
    - ACK Tunneling
    - HTTP Tunneling
    - SSH Tunneling
    - DNS Tunneling - exploits the DNS protocol to tunnel malware and other data through a client-server model.
    - Through External Systems
    - Through MITM Attack
    - Through Content
    - Through XSS Attack
- Firewall detection
    - TCP ACK segments use for gathering information about firewall or ACL configuration. This type of scan aims to discover information about filter configurations rather than a port state. This type of scanning is rarely useful alone, but when combined with SYN scanning, it gives a more complete picture of the type of present firewall rules.
    - When a TCP ACK segment is sent to a closed port or sent out-of-sync to a listening port, the RFC 793 expected behavior is for the device to respond with an RST. Getting RSTs back in response to an ACK scan gives useful information that can be used to infer the type of firewall present. **Stateful firewalls will discard out-of-sync ACK packets, leading to no response. When this occurs, the port is marked as filtered**.
## tools
- honeypot
    - KFSensor
    - SPECTER
- Snort
- mobile IPSs
    - zIPS
    - wifi inspector
    - wifi intruder detect
- AlienVault USM

---
### [Back to index](../README.md) | [Go to next module](13.md)